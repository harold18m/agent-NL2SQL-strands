# =============================================================================
# Multi-stage Dockerfile for AWS Lambda (Python 3.11)
# Optimized for smaller image size and faster cold starts
# =============================================================================

# Stage 1: Builder - Install dependencies
FROM public.ecr.aws/lambda/python:3.11 AS builder
WORKDIR /var/task
COPY pyproject.toml .
RUN pip install --upgrade pip && pip install --no-cache-dir .

# Stage 2: Runtime - Copy only what's needed
FROM public.ecr.aws/lambda/python:3.11
WORKDIR /var/task
COPY --from=builder /var/lang/lib/python3.11/site-packages /var/lang/lib/python3.11/site-packages
COPY app/ app/
COPY lambda_handler.py .
CMD ["lambda_handler.handler"]